<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Teste R√°pido - Carrinho</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .btn { padding: 10px 15px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-success { background: #4CAF50; color: white; }
        .btn-primary { background: #2196F3; color: white; }
        .btn-warning { background: #FF9800; color: white; }
        .resultado { margin: 20px 0; padding: 15px; background: #f5f5f5; border-radius: 5px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>üß™ Teste R√°pido do Carrinho</h1>
    
    <div>
        <button class="btn btn-success" onclick="testearAPI()">üîß Testar API Diretamente</button>
        <button class="btn btn-primary" onclick="testearCarrinho()">üõí Testar Carrinho JS</button>
        <button class="btn btn-warning" onclick="limparTestes()">üßπ Limpar</button>
    </div>
    
    <div id="resultado" class="resultado">
        <strong>Clique em um bot√£o para iniciar os testes...</strong>
    </div>
    
    <script>
        function log(mensagem) {
            const resultado = document.getElementById('resultado');
            resultado.innerHTML += new Date().toLocaleTimeString() + ': ' + mensagem + '<br>';
        }
        
        function limparTestes() {
            document.getElementById('resultado').innerHTML = '<strong>Logs limpos...</strong><br>';
        }
        
        async function testearAPI() {
            log('üîß Iniciando teste da API...');
            
            try {
                // Teste 1: Adicionar item
                log('üì° Testando POST /api/carrinho/adicionar');
                const response = await fetch('http://localhost:8080/api/carrinho/adicionar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        celular: '11999000000',
                        tipoProduto: 'boloBase',
                        nomeProduto: 'Bolo Teste',
                        preco: 85.00,
                        quantidade: 1,
                        categoria: 'bolos'
                    })
                });
                
                if (response.ok) {
                    const resultado = await response.json();
                    log('‚úÖ POST funcionou: ' + JSON.stringify(resultado));
                } else {
                    log('‚ùå POST falhou: ' + response.status + ' ' + response.statusText);
                }
                
                // Teste 2: Buscar carrinho
                log('üì° Testando GET /api/carrinho/11999000000');
                const response2 = await fetch('http://localhost:8080/api/carrinho/11999000000');
                
                if (response2.ok) {
                    const resultado2 = await response2.json();
                    log('‚úÖ GET funcionou. Itens: ' + (resultado2.totalItens || 0));
                } else {
                    log('‚ùå GET falhou: ' + response2.status + ' ' + response2.statusText);
                }
                
            } catch (error) {
                log('‚ùå Erro no teste da API: ' + error.message);
            }
        }
        
        async function testearCarrinho() {
            log('üõí Testando carrinho JavaScript...');
            
            // Verificar se existe
            if (typeof window.carrinho !== 'undefined') {
                log('‚úÖ window.carrinho existe');
                
                try {
                    // Testar obter celular
                    log('üì± Testando obten√ß√£o de celular...');
                    const celular = await window.carrinho.obterCelular();
                    if (celular) {
                        log('‚úÖ Celular obtido: ' + celular);
                        
                        // Testar adicionar item
                        log('üõí Testando adi√ß√£o de item...');
                        await window.carrinho.adicionarItem('boloBase', 'Bolo Teste JS', 95.00);
                        log('‚úÖ Teste de adi√ß√£o conclu√≠do');
                        
                    } else {
                        log('‚ùå Falha ao obter celular');
                    }
                } catch (error) {
                    log('‚ùå Erro no teste do carrinho: ' + error.message);
                }
            } else {
                log('‚ùå window.carrinho N√ÉO existe');
                
                // Verificar fun√ß√£o global
                if (typeof adicionarAoCarrinho === 'function') {
                    log('‚úÖ Fun√ß√£o adicionarAoCarrinho existe');
                    try {
                        await adicionarAoCarrinho('boloBase', 'Bolo Teste Global', 105.00);
                        log('‚úÖ Teste da fun√ß√£o global conclu√≠do');
                    } catch (error) {
                        log('‚ùå Erro na fun√ß√£o global: ' + error.message);
                    }
                } else {
                    log('‚ùå Fun√ß√£o adicionarAoCarrinho N√ÉO existe');
                }
            }
        }
    </script>
    
    <!-- Carregar o script do carrinho -->
    <script src="/js/carrinho.js"></script>
</body>
</html>